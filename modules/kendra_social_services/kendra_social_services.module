<?php
/**
 * @file
 * Code for the Kendra Social Services feature.
 */

include_once DRUPAL_ROOT . '/' . drupal_get_path('module', 'kendra_social_services') . '/kendra_social_services.features.inc';
include_once DRUPAL_ROOT . '/' . drupal_get_path('module', 'kendra_social_services') . '/kendra_social_services.resources.inc';
include_once DRUPAL_ROOT . '/' . drupal_get_path('module', 'kendra_social_services') . '/kendra_social_services.callbacks.inc';

function kendra_social_services_permission() {
	return array(
    'access kendra social connect' => array(
      'title' => t('Access Kendra Social Connect services'), 
      'description' => t('Perform social connect operations via the API'),
	),
	);
}

function kendra_social_services_services_resources_controller_post_processing_alter(&$services) {
  $services['user/retrieve']['args'][0]['type'] = 'string';
  $services['user/retrieve']['access callback'] = '_kss_user_retrieve_access_check';
  $services['user/retrieve']['callback'] = '_kss_user_retrieve_callback';
}

function _kss_user_retrieve_access_check($op = 'view', $args = array()) {
       if ($args[0] == 'me') { 
	         return TRUE; 
       } else {
         return _user_resource_access($op, $args);
       }
}
function _kss_user_retrieve_callback($uid) {
       if ($uid == 'me') {
	               global $user;
               $uid = $user->uid;
       }
       return _user_resource_retrieve($uid);
}
